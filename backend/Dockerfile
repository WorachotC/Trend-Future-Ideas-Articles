FROM python:3.10-slim

WORKDIR /app

# 1. ‡∏•‡∏á Dependencies ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Linux ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
RUN apt-get update && apt-get install -y \
    wget \
    gnupg \
    && rm -rf /var/lib/apt/lists/*

# 2. ‡∏•‡∏á Python Libraries
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 3. üî• ‡∏•‡∏á Playwright ‡πÅ‡∏•‡∏∞ Browser (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
# - install-deps: ‡∏•‡∏á‡∏û‡∏ß‡∏Å library ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà chromium ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ (‡πÄ‡∏ä‡πà‡∏ô libgtk, libasound)
# - install chromium: ‡∏•‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ chromium ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á firefox/webkit)
RUN playwright install-deps
RUN playwright install chromium

COPY . .

# 4. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Å‡∏±‡∏ô Error ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Permission)
RUN mkdir -p /app/data/processed && chmod -R 777 /app/data

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]